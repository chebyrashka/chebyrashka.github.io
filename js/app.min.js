!function(e){e.fn.columnize=function(t){var o={width:400,columns:!1,buildOnce:!1,overflow:!1,doneFunc:function(){},target:!1,ignoreImageLoading:!0,columnFloat:"left",lastNeverTallest:!1,accuracy:!1,manualBreaks:!1,cssClassPrefix:""};return t=e.extend(o,t),"string"==typeof t.width&&(t.width=parseInt(t.width,10),isNaN(t.width)&&(t.width=o.width)),this.each(function(){function n(e,t){var o=t?".":"";return m.length?o+m+"-"+e:o+e}function s(o,s,a,l){for(;(u||a.height()<l)&&s[0].childNodes.length;){var i=s[0].childNodes[0];if(e(i).find(n("columnbreak",!0)).length)return;if(e(i).hasClass(n("columnbreak")))return;o.append(i)}if(0!==o[0].childNodes.length){var d=o[0].childNodes,r=d[d.length-1];o[0].removeChild(r);var c=e(r);if(3==c[0].nodeType){var h=c[0].nodeValue,p=t.width/18;t.accuracy&&(p=t.accuracy);for(var m,f=null;a.height()<l&&h.length;){var v=h.indexOf(" ",p);m=-1!=v?h.substring(0,h.indexOf(" ",p)):h,f=document.createTextNode(m),o.append(f),h=h.length>p&&-1!=v?h.substring(v):""}if(a.height()>=l&&null!==f&&(o[0].removeChild(f),h=f.nodeValue+h),!h.length)return!1;c[0].nodeValue=h}return s.contents().length?s.prepend(c):s.append(c),3==c[0].nodeType}}function a(e,t,o,l){if(!e.contents(":last").find(n("columnbreak",!0)).length&&!e.contents(":last").hasClass(n("columnbreak"))&&t.contents().length){var i=t.contents(":first");if(1!=i.get(0).nodeType)return;var d=i.clone(!0);i.hasClass(n("columnbreak"))?(e.append(d),i.remove()):u?(e.append(d),i.remove()):1!=d.get(0).nodeType||d.hasClass(n("dontend"))||(e.append(d),d.is("img")&&o.height()<l+20?i.remove():!i.hasClass(n("dontsplit"))&&o.height()<l+20?i.remove():d.is("img")||i.hasClass(n("dontsplit"))?d.remove():(d.empty(),s(d,i,o,l)?i.addClass(n("split")):(i.addClass(n("split")),i.children().length&&a(d,i,o,l)),0===d.get(0).childNodes.length&&d.remove()))}}function l(){if(!r.data("columnized")||1!=r.children().length){if(r.data("columnized",!0),r.data("columnizing",!0),r.empty(),r.append(e("<div class='"+n("first")+" "+n("last")+" "+n("column")+" ' style='width:100%; float: "+t.columnFloat+";'></div>")),$col=r.children().eq(r.children().length-1),$destroyable=h.clone(!0),t.overflow){for(targetHeight=t.overflow.height,s($col,$destroyable,$col,targetHeight),$destroyable.contents().find(":first-child").hasClass(n("dontend"))||a($col,$destroyable,$col,targetHeight);$col.contents(":last").length&&i($col.contents(":last").get(0));){var o=$col.contents(":last");o.remove(),$destroyable.prepend(o)}for(var l="",d=document.createElement("DIV");$destroyable[0].childNodes.length>0;){var c=$destroyable[0].childNodes[0];if(c.attributes)for(var p=0;p<c.attributes.length;p++)0===c.attributes[p].nodeName.indexOf("jQuery")&&c.removeAttribute(c.attributes[p].nodeName);d.innerHTML="",d.appendChild($destroyable[0].childNodes[0]),l+=d.innerHTML}var u=e(t.overflow.id)[0];u.innerHTML=l}else $col.append($destroyable);r.data("columnizing",!1),t.overflow&&t.overflow.doneFunc&&t.overflow.doneFunc()}}function i(t){return 3==t.nodeType?/^\s+$/.test(t.nodeValue)&&t.previousSibling?i(t.previousSibling):!1:1!=t.nodeType?!1:e(t).hasClass(n("dontend"))?!0:0===t.childNodes.length?!1:i(t.childNodes[t.childNodes.length-1])}function d(){if(f=0,p!=r.width()){p=r.width();var o=Math.round(r.width()/t.width),d=t.width,m=t.height;if(t.columns&&(o=t.columns),u&&(o=h.find(n("columnbreak",!0)).length+1,d=!1),1>=o)return l();if(!r.data("columnizing")){r.data("columnized",!0),r.data("columnizing",!0),r.empty(),r.append(e("<div style='width:"+Math.floor(100/o)+"%; float: "+t.columnFloat+";'></div>")),y=r.children(":last"),y.append(h.clone()),c=y.height(),r.empty();var v=c/o,$=3,g=!1;t.overflow?($=1,v=t.overflow.height):m&&d&&($=1,v=m,g=!0);for(var w=0;$>w&&20>w;w++){r.empty();var C,b,y,T;try{C=h.clone(!0)}catch(x){C=h.clone()}C.css("visibility","hidden");for(var N=0;o>N;N++)b=0===N?n("first"):"",b+=" "+n("column"),b=N==o-1?n("last")+" "+b:b,r.append(e("<div class='"+b+"' style='width:"+Math.floor(100/o)+"%; float: "+t.columnFloat+";'></div>"));for(N=0;N<o-(t.overflow?0:1)||g&&C.contents().length;){for(r.children().length<=N&&r.append(e("<div class='"+b+"' style='width:"+Math.floor(100/o)+"%; float: "+t.columnFloat+";'></div>")),y=r.children().eq(N),g&&y.width(d+"px"),s(y,C,y,v),a(y,C,y,v);y.contents(":last").length&&i(y.contents(":last").get(0));)T=y.contents(":last"),T.remove(),C.prepend(T);N++,0===y.contents().length&&C.contents().length?y.append(C.contents(":first")):N!=o-(t.overflow?0:1)||t.overflow||C.find(n("columnbreak",!0)).length&&o++}if(t.overflow&&!g){var k=!1,z=document.all&&-1!=navigator.appVersion.indexOf("MSIE 7.");if(k||z){for(var I="",L=document.createElement("DIV");C[0].childNodes.length>0;){var M=C[0].childNodes[0];for(N=0;N<M.attributes.length;N++)0===M.attributes[N].nodeName.indexOf("jQuery")&&M.removeAttribute(M.attributes[N].nodeName);L.innerHTML="",L.appendChild(C[0].childNodes[0]),I+=L.innerHTML}var F=e(t.overflow.id)[0];F.innerHTML=I}else e(t.overflow.id).empty().append(C.contents().clone(!0))}else if(g)r.children().each(function(e){y=r.children().eq(e),y.width(d+"px"),0===e?y.addClass(n("first")):e==r.children().length-1?y.addClass(n("last")):(y.removeClass(n("first")),y.removeClass(n("last")))}),r.width(r.children().length*d+"px");else{y=r.children().eq(r.children().length-1),C.contents().each(function(){y.append(e(this))});var H=(y.height(),0),O=1e7,V=0,q=!1,E=0;r.children().each(function(e){return function(t){var o=e.children().eq(t),s=o.children(":last").find(n("columnbreak",!0)).length;if(!s){var a=o.height();q=!1,H+=a,a>V&&(V=a,q=!0),O>a&&(O=a),E++}}}(r));var P=H/E;0===H?w=$:t.lastNeverTallest&&q?(f+=30,v+=30,w==$-1&&$++):V-O>30?v=P+30:Math.abs(P-v)>20?v=P:w=$}}r.find(n("column",!0)).find(":first"+n("removeiffirst",!0)).remove(),r.find(n("column",!0)).find(":last"+n("removeiflast",!0)).remove(),r.data("columnizing",!1),t.overflow&&t.overflow.doneFunc(),t.doneFunc()}}}var r=e(t.target?t.target:this),c=e(this).height(),h=e("<div></div>"),p=0,u=t.manualBreaks,m=o.cssClassPrefix;"string"==typeof t.cssClassPrefix&&(m=t.cssClassPrefix);var f=0;if(h.append(e(this).contents().clone(!0)),!t.ignoreImageLoading&&!t.target&&!r.data("imageLoaded")&&(r.data("imageLoaded",!0),e(this).find("img").length>0)){var v=function(e,o){return function(){e.data("firstImageLoaded")||(e.data("firstImageLoaded","true"),e.empty().append(o.children().clone(!0)),e.columnize(t))}}(e(this),h);return e(this).find("img").one("load",v),void e(this).find("img").one("abort",v)}r.empty(),d(),t.buildOnce||e(window).resize(function(){t.buildOnce||(r.data("timeout")&&clearTimeout(r.data("timeout")),r.data("timeout",setTimeout(d,200)))})})}}(jQuery),$(document).ready(function(){function e(){$(".post").removeClass("dontsplit"),$(".posts .column").each(function(){$(this).children().clone(!0).appendTo(".posts")}),$(".posts .content .tools").remove(),$(".posts .column").remove()}function t(){return $(".modal, .modal-bg").fadeOut().queue(function(e){$(".modal, .modal-bg").remove(),e()}),!1}$(".photo.video a").append("<span></span>"),$(".masthead input[type=text]").addClass("off"),$(".masthead input[type=text]").on("focus",function(){$(this).removeClass("off")}),$(".settings .avatar a").on("click",function(){$(".settings nav").toggleClass("on")}),$(".posts.view-list > .post").each(function(){$(this).children(".photo").size()>0&&$(this).addClass("noborder")}),$(".post .content").each(function(){$(this).siblings(".responses").size()>0&&$(this).append('<a href="#!" class="expand" data-togglevalue="Collapse">Expand</a>')}),$(".post .content").on("click",".expand",function(e){var t=$(this).text();$(this).text($(this).data("togglevalue")),$(this).data("togglevalue",t),$(this).toggleClass("on"),$(this).parent().next(".responses").slideToggle(),e.preventDefault()}),$(".post:gt(5)").hide(),$(".load-more").on("click",function(){$(".post:gt(5)").slideToggle(),$(this).hide()}),$(".view-mode a.view-list").on("click",function(){if($(".posts.view-list").size()<=0){$(".view-mode a").removeClass("on"),$(this).addClass("on");var t=$(this).data("viewmode"),o=$(".posts").attr("class").split(" ")[1];$(".posts").removeClass(o).addClass(t),$(".load-more").hide(),e()}return!1}),$(".view-mode a.view-tile").on("click",function(){if($(".posts.view-tile").size()<=0){$(".post").show(),$(".view-mode a").removeClass("on"),$(this).addClass("on");var e=$(this).data("viewmode"),t=$(".posts").attr("class").split(" ")[1];$(".posts").removeClass(t).addClass(e),$(".posts > .post > .content").each(function(){$(this).children(".expand").size()>0&&$(this).closest(".post").children(".tools").clone().appendTo($(this).closest(".post").find(".content"))}),$(".post").addClass("dontsplit"),$(".posts").columnize({columns:3,lastNeverTallest:!0}),$(".load-more").hide()}return!1}),$(".filter a.all").on("click",function(){return 0==$(this).hasClass("on")&&($(".posts").removeClass("view-tile").addClass("view-list"),$(".filter a").removeClass("on"),$(this).addClass("on"),$(".view-mode").show(),$(".post").show(),$(".load-more").hide(),e()),!1}),$(".filter a.photos").on("click",function(){return $(".posts").removeClass("view-list").addClass("view-tile"),$(".filter a").removeClass("on"),$(this).addClass("on"),$(".view-mode").hide(),$(".posts .column").each(function(){$(this).children().clone(!0).appendTo(".posts")}),$(".posts .content .tools").remove(),$(".posts .column").remove(),$(".post").addClass("dontsplit"),$(".post ").show(),$(".post ").not($(".photo:not(.video)").parent()).hide(),$(".posts").columnize({columns:3,lastNeverTallest:!0}),$(".load-more").hide(),!1}),$(".filter a.videos").on("click",function(){return $(".posts").removeClass("view-list").addClass("view-tile"),$(".filter a").removeClass("on"),$(this).addClass("on"),$(".view-mode").hide(),$(".posts .column").each(function(){$(this).children().clone(!0).appendTo(".posts")}),$(".posts .content .tools").remove(),$(".posts .column").remove(),$(".post").addClass("dontsplit"),$(".post ").show(),$(".post ").not($(".photo.video").parent()).hide(),$(".posts").columnize({columns:3,lastNeverTallest:!0}),$(".load-more").hide(),!1}),$(".newmsg").on("click",function(){return $("body").append('<div class="modal-bg"></div>'),$("body").append('<div class="modal" tabindex="0"></div>'),$(".modal").load("sub-createmsg.html",function(){$(".modal section").append('<a href="#!" class="close">Close</a>'),$(".modal-bg").fadeIn(500),$(".modal").delay(500).fadeIn(500)}),!1}),$(".posts .photo a").on("click",function(){return $("body").append('<div class="modal-bg"></div>'),$("body").append('<div class="modal photo" tabindex="0"></div>'),$(this).closest(".post").clone().appendTo(".modal"),$(".modal .photo").prependTo(".modal"),$(".modal .post .content").after('<div class="responses"><form method="post" action="#!"><input type="text" placeholder="Reply" /></form></div>'),$(".modal .photo").append('<a href="#!" class="close">Close</a>'),$(".modal-bg").fadeIn(500),$(".modal").delay(500).fadeIn(500),!1}),$("body").on("click",".close",t),$("body").on("click",".modal-bg",t),$(document).keyup(function(e){27==e.keyCode&&t()})});